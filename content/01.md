# Malware

Malicious software is intentionally designed to do harmful behavior to computer systems and networks Researchers tend to categorize malware into types based on their behavior.

- Popular types include viruses, ransomware, worms, trojans, backdoors, logic bombs, and key loggers.
- Spyware and adware (sometimes called grayware) are often included in the mix.

## Malware Analysis

Researchers analyze malware to understand the functionality, origin, and impact on systems.

- **Static Analysis** involves examining the malware without executing it, using techniques such as disassembly and decompilation to reverse engineer the code and understand its functionality.
- **Dynamic Analysis** involves executing the malware in a controlled environment (such as a sandbox) and observing its behavior.

## Practice

- Install ClamAV (popular open-source antivirus engine for detecting malware)

   ```bash
   sudo apt install clamav
   ```

- Download [EICAR](https://en.wikipedia.org/wiki/EICAR_test_file) (sample file to test antivirus systems)

   ```bash
   mkdir sample && cd sample
   wget https://secure.eicar.org/eicar.com.txt
   ```

- Update database of virus signatures (https://lists.clamav.net/pipermail/clamav-virusdb/)

   ```bash
   sudo freshclam
   ```

- Run a scan for a directory, only showing infected files ([clamscan tldr page](https://tldr.inbrowser.app/pages/common/clamscan)).

   ```shell
   clamscan -i -r <dir>
   ```

## Threat Databases

Antivirus vendors maintain a database of known threats, to raise awareness and help detection and prevention.

- Kaspersky Threat Database: https://threats.kaspersky.com/en/threat/
- Microsoft Threat Database: https://www.microsoft.com/en-us/wdsi/threats/threat-search?query=Win32

Threat naming system usually follows a consistent format `Type:Platform[./]Name`

- E.g., [`Ransom:Win32/WannaCrypt`](https://www.microsoft.com/en-us/wdsi/threats/malware-encyclopedia-description?Name=Ransom:Win32/WannaCrypt) or [`Backdoor:Linux.RevShell.c`](https://threats.kaspersky.com/en/threat/Backdoor.Linux.RevShell.c/).

## Exercise 1

> [!CAUTION]
>
> - NEVER execute suspecious files outside of an isolated sandbox.
> - NEVER try to analyze malware samples on your host.

1. You encountered an unknown file in the wild

   ```bash
   wget https://gist.github.com/Sh3b0/264a0975562bee01a18f53056b4d3023/raw/e1144fe393cd7f2b8ad073a13b8c0ba61a823bc6/suspecious.vbs
   ```

2. Identify the malware: scan it with ClamAV, also upload it to an analysis service to compare results:

   - VirusTotal: https://www.virustotal.com/gui/file/

   - Kaspersky Threat Intelligence: https://opentip.kaspersky.com/

   - Hybrid-Analysis: https://hybrid-analysis.com/

2. After identifying the malware, find its description page on Kaspersky and Microsoft threat databases.

2. [Malpedia](https://malpedia.caad.fkie.fraunhofer.de/library) is another popular database of Malware families, actors, and blogs. Find the informational page of the malware family there.

