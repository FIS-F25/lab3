# Malware Detection

After discovering a new malware type, researchers usually construct **signatures** to be used by anti-viruses and [Intrusion Detection Systems (IDS)](https://en.wikipedia.org/wiki/Intrusion_detection_system) to automatically detect further infections of the same malware. 

- Malware signature is the most common form of IoCs ([Indicators of Compromise](https://en.wikipedia.org/wiki/Indicator_of_compromise))

## Practice

[YARA](https://github.com/VirusTotal/yara) is an open-source pattern-matching engine for files (even binaries). It helps identify and classify malware samples using a description (rule) syntax.

1. Install YARA

   ```bash
   sudo apt install yara
   ```

1. Write a detection rule for EICAR: `eicar.yara`

   > Large collections of rules for known malware are available online (e.g., [Valhalla API](https://valhalla.nextron-systems.com/) or [GitHub](https://github.com/InQuest/awesome-yara))

   ```yara
   rule EICAR_Detection {
       meta:
           description = "Comprehensive EICAR test file detection"
           author = "Security Analyst"
           date = "2025"
           reference = "https://www.eicar.org/download-anti-malware-testfile/"
           
       strings:
           // Full EICAR string
           $eicar_full = "X5O!P%@AP[4\\PZX54(P^)7CC)7}$EICAR-STANDARD-ANTIVIRUS-TEST-FILE!$H+H*"
           
           // Common variations and partial matches
           $eicar_partial1 = "EICAR-STANDARD-ANTIVIRUS-TEST-FILE"
           $eicar_partial2 = "X5O!P%@AP"
           $eicar_partial3 = "PZX54(P^)7CC)7}"
           
       condition:
           any of them
   }
   ```

1. Test the rule against the file

   ```bash
   wget https://secure.eicar.org/eicar.com.txt
   yara eicar_rule.yar eicar.com.txt
   ```

## Exercise 2

Can you write a `.yara` rule to match the malware from exercise 1?

- A good rules is generic as much as possible, it's able to match variations of the same malware effectively.
- Write and test the rule, verify it works against the downloaded file.

